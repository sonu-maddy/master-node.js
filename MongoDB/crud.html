<!-- Start your backend:
     node mongoose2.js  ---Server running on http://localhost:8000
Open index.html in your browser (just double-click it or use Live Server in VS Code). -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Management</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    input, button { margin: 5px; padding: 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .edit-form { display: none; margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Users (Info Collection)</h1>

  <!-- Form to add a user -->
  <form id="userForm">
    <input type="text" id="first_name" placeholder="First Name" required />
    <input type="text" id="last_name" placeholder="Last Name" />
    <input type="email" id="email" placeholder="Email" required />
    <input type="text" id="job_title" placeholder="Job Title" />
    <input type="text" id="gender" placeholder="Gender" />
    <button type="submit">Add User</button>
  </form>

  <!-- Users Table -->
  <table>
    <thead>
      <tr>
        <th>First</th>
        <th>Last</th>
        <th>Email</th>
        <th>Job</th>
        <th>Gender</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="usersTable"></tbody>
  </table>

  <!-- Edit Form -->
  <div class="edit-form" id="editFormContainer">
    <h3>Edit User</h3>
    <form id="editForm">
      <input type="hidden" id="edit_id" />
      <input type="text" id="edit_first_name" placeholder="First Name" required />
      <input type="text" id="edit_last_name" placeholder="Last Name" />
      <input type="email" id="edit_email" placeholder="Email" required />
      <input type="text" id="edit_job_title" placeholder="Job Title" />
      <input type="text" id="edit_gender" placeholder="Gender" />
      <button type="submit">Update User</button>
      <button type="button" onclick="cancelEdit()">Cancel</button>
    </form>
  </div>

  <script>
    const API_URL = "http://localhost:8000/api/users";

    // Fetch and show all users
    async function loadUsers() {
      const res = await fetch(API_URL);
      const users = await res.json();

      const table = document.getElementById("usersTable");
      table.innerHTML = users.map(u => `
        <tr>
          <td>${u.first_name}</td>
          <td>${u.last_name || ""}</td>
          <td>${u.email}</td>
          <td>${u.job_title || ""}</td>
          <td>${u.gender || ""}</td>
          <td>
            <button onclick="editUser('${u._id}','${u.first_name}','${u.last_name || ""}','${u.email}','${u.job_title || ""}','${u.gender || ""}')">Edit</button>
            <button onclick="deleteUser('${u._id}')">Delete</button>
          </td>
        </tr>
      `).join("");
    }

    // Add user
    document.getElementById("userForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        email: document.getElementById("email").value,
        job_title: document.getElementById("job_title").value,
        gender: document.getElementById("gender").value,
      };

      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user),
      });

      e.target.reset();
      loadUsers();
    });

    // Delete user
    async function deleteUser(id) {
      await fetch(`${API_URL}/${id}`, { method: "DELETE" });
      loadUsers();
    }

    // Open edit form with data
    function editUser(id, first, last, email, job, gender) {
      document.getElementById("edit_id").value = id;
      document.getElementById("edit_first_name").value = first;
      document.getElementById("edit_last_name").value = last;
      document.getElementById("edit_email").value = email;
      document.getElementById("edit_job_title").value = job;
      document.getElementById("edit_gender").value = gender;
      document.getElementById("editFormContainer").style.display = "block";
    }

    // Cancel edit
    function cancelEdit() {
      document.getElementById("editFormContainer").style.display = "none";
    }

    // Update user (PATCH)
    document.getElementById("editForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("edit_id").value;

      const updatedUser = {
        first_name: document.getElementById("edit_first_name").value,
        last_name: document.getElementById("edit_last_name").value,
        email: document.getElementById("edit_email").value,
        job_title: document.getElementById("edit_job_title").value,
        gender: document.getElementById("edit_gender").value,
      };

      await fetch(`${API_URL}/${id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedUser),
      });

      cancelEdit();
      loadUsers();
    });

    // Load users on page load
    loadUsers();
  </script>
</body>
</html>
